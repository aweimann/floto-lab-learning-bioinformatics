<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Santiago Caño-Muñiz" />


<title>Rmarkdown tutorial</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Learning bioinformatics</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="introduction.to.R.html">Introduction to R</a>
</li>
<li>
  <a href="how.to.use.RStudio.html">How to use RStudio</a>
</li>
<li>
  <a href="more.advanced.R.html">More advanced R</a>
</li>
<li>
  <a href="ggplot2.html">ggplot2</a>
</li>
<li>
  <a href="glossary.of.R.terms.html">Glossary of R terms</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Rmarkdown tutorial</h1>
<h4 class="author">Santiago Caño-Muñiz</h4>
<h4 class="date">16/04/2020</h4>

</div>


<div id="r-mark..what" class="section level1">
<h1><span class="header-section-number">1</span> R Mark..what?</h1>
<p>In this tutorial we will learn the basic procedures to work with R Markdown. The RMarkdown framework is a scientific authoring framework and aims to embed the executable code in a proper document. For example, the super-cool website that we have prepared for this workshop has been fully built with RMarkdown (courtesy of Dr Weimann!).</p>
<p>In order to make the tutorial more engaging, we will base the tutoral on a practical case study: the analysis of the COVID19 epidemic that send us home in the first place. For that, let me open a new section with the <code>#</code> notation.</p>
</div>
<div id="the-covid19-dataset" class="section level1">
<h1><span class="header-section-number">2</span> The COVID19 dataset</h1>
<p>The human and economic toll of COVID-19 is a stark reminder of the fragility of our globalised society. The ability of a country to contain the outbreak across borders is being defined by their capacity to provide effective protection to the most vulnerable. However, the global pandemic has not impacted all the countries equally. To prove this, we will take a look into the <code>COVID19_countries_data.csv</code> table. Let’s then create our first “code chunk” with “```” and load the data and libraries that we have learned during the workshop.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># We open the code chuck with ``` followed with a {}. Within the curly bracketes with </span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># can specify few argumets. An easier way to add a new code segment could be to click </span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># on the icon &quot;Insert&quot; in the upper right corner of the code editor. </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># For now, we will just write &quot;r&quot; as it denotes that the code we will use </span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># is written in the R language. Once we are inside the code chunk, the code follows again the R syntax.</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co"># Load the libraries</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"># Load the data</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14">dtime &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;https://raw.githubusercontent.com/aweimann/floto-lab-learning-bioinformatics/master/datasets/COVID19_cases_and_policy.csv&quot;</span>)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="kw">str</span>(dtime)</a></code></pre></div>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   15450 obs. of  41 variables:
##  $ countryterritoryCode                                 : chr  &quot;ABW&quot; &quot;ABW&quot; &quot;ABW&quot; &quot;ABW&quot; ...
##  $ date                                                 : chr  &quot;2020-01-22&quot; &quot;2020-01-23&quot; &quot;2020-01-24&quot; &quot;2020-01-25&quot; ...
##  $ Country                                              : chr  &quot;Netherlands&quot; &quot;Netherlands&quot; &quot;Netherlands&quot; &quot;Netherlands&quot; ...
##  $ confirm                                              : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ death                                                : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ recov                                                : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Oxford_stringency_level                              : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ Additional health/documents requirements upon arrival: int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Amendments to funeral and burial regulations         : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Awareness campaigns                                  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Border checks                                        : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Border closure                                       : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Changes in prison-related policies                   : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Checkpoints within the country                       : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Complete border closure                              : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Curfews                                              : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Domestic travel restrictions                         : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Economic measures                                    : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Full lockdown                                        : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ General recommendations                              : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Health screenings in airports and border crossings   : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Humanitarian exemptions                              : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ International flights suspension                     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Introduction of quarantine policies                  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Limit product imports/exports                        : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Limit public gatherings                              : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Lockdown of refugee/idp camps or other minorities    : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Mass population testing                              : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Military deployment                                  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Obligatory medical tests not related to COVID-19     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Partial lockdown                                     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Psychological assistance and medical social work     : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Public services closure                              : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Schools closure                                      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ State of emergency declared                          : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Strengthening the public health system               : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Surveillance and monitoring                          : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Testing policy                                       : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ Visa restrictions                                    : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ region                                               : chr  &quot;Americas&quot; &quot;Americas&quot; &quot;Americas&quot; &quot;Americas&quot; ...
##  $ sub-region                                           : chr  &quot;Latin America and the Caribbean&quot; &quot;Latin America and the Caribbean&quot; &quot;Latin America and the Caribbean&quot; &quot;Latin America and the Caribbean&quot; ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<p>We have just created our first piece of code. Note that we have not yet run it. If we would like to run an individual code chunk, we have to click on the little play buttom on the upper right corner of the cell. We will see all the output appear that we normally see when we run code in the console. In this case we see some messages from the libraries loaded and a preview of the data table. To suppress any internal R messages we could use message = False in side the curly braces (try it out). We can also include plots in the code chunk:.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Between the brackets, we separate the arguments with &quot;,&quot;</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">dtime[, date <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.Date</span>(date) <span class="co"># convert the date column into dates, which allow us quite </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">                              <span class="co"># cool operations when we work with time series</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">      ]</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">dtime[,</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">      .(<span class="dt">World_count =</span> <span class="kw">sum</span>(confirm)), <span class="co"># Sum all the cases</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">      by =<span class="st"> </span>date                      <span class="co"># by date</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">      ] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="st">  </span><span class="co"># pass the cumulative casese to the ggplot command</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="st">  </span><span class="co"># remember the . is a placeholder for the data frame above</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="st">  </span><span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> date, </a>
<a class="sourceLine" id="cb3-16" data-line-number="16">                <span class="dt">y =</span> World_count)) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="st">  </span><span class="co"># Enhance output</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;World total confirmed cases&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Date&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="st">  </span><span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">20</span>)</a></code></pre></div>
<p><img src="Rmarkdown_tutorial_files/figure-html/unnamed-chunk-1-1.png" width="1248" style="display: block; margin: auto;" /></p>
<p>Now, let’s take a look at the data because as we said at the beginning. Remember what we said at the beginning: not all countries have been affected equally. We will try to figure out when the virus took root in each country. Let’s consider that an outbreak has started if or when the number of cases reached 100 cases. Here is the code we need:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">dtime[confirm <span class="op">&lt;</span><span class="st"> </span><span class="dv">101</span>, <span class="co"># We select the rows with less than 100 cases</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">      .(<span class="dt">outbreak_date =</span>  <span class="kw">max</span>(date),</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">        confirm, region, date), <span class="co"># Assuming that the cummulative number of cases only increase,</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                     <span class="co"># we select the latest date (or maximum)</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">      by =<span class="st"> </span>Country]  <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Repeat the operation for every country</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  </span>.[date <span class="op">==</span><span class="st"> </span>outbreak_date] -&gt;<span class="st"> </span>outbreak_date</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">dtime[,</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">      .(<span class="dt">Regional_count =</span> <span class="kw">sum</span>(confirm)), <span class="co"># Sum all the cases</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">      by =<span class="st"> </span>.(date, region)           <span class="co"># by date AND region</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">      ] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="st">  </span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> date, </a>
<a class="sourceLine" id="cb4-14" data-line-number="14">                <span class="dt">y =</span> Regional_count)) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="st">  </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="st">  </span><span class="co"># Call our second dataset</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> outbreak_date, </a>
<a class="sourceLine" id="cb4-18" data-line-number="18">             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">xintercept =</span> outbreak_date <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(outbreak_date), <span class="dt">sd =</span> <span class="fl">0.2</span>),</a>
<a class="sourceLine" id="cb4-19" data-line-number="19">                 <span class="dt">col =</span> region), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="st">  </span><span class="kw">facet_wrap</span>(region <span class="op">~</span>.) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="st">  </span><span class="kw">theme_classic</span>(<span class="dt">base_size =</span> <span class="dv">15</span>)</a></code></pre></div>
<p><img src="Rmarkdown_tutorial_files/figure-html/unnamed-chunk-2-1.png" width="1248" style="display: block; margin: auto;" /></p>
<p>We knew that the COVID19 started in China and the first cases were detected as early as December. Still, we can see the exponential nature of the spread, first in Asian countries outside of China and then in Europe. Another way to look at it could be count the number of countries that have an outbreak in each region according out our definition:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">outbreak_date[,</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">              .(<span class="dt">count =</span> .N), <span class="co"># .N key notation to get the number of elements within out particular sub-group</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">              by =<span class="st"> </span>.(region, date)] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> count, <span class="dt">fill =</span> region)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">  </span><span class="kw">facet_wrap</span>(region <span class="op">~</span>.) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="st">  </span><span class="kw">theme_classic</span>(<span class="dt">base_size =</span> <span class="dv">15</span>)</a></code></pre></div>
<p><img src="Rmarkdown_tutorial_files/figure-html/unnamed-chunk-3-1.png" width="1248" /> At this point, we could propose few hypotheses to find out why the epidemy took this dynamic. Here, we will discuss three examples that also will help us to familiarise with the tools we have learned throught the course. Our hypothesis are (Notice how we use the “-” syntax to denote a list): - The number of cases per country is just an artifact, it just depends on the size of the population. - The number of cases depends on the number of tourists because they can carry the disease without symptoms, they act as vector between countries. Nevertheless, we don’t know whether the real relation happens via leaving or arriving tourist, a combination of both, or even the ratio of tourist to population. - The number of cases depends on the stringency of the preventive measures introduced. This might seem a rather qualitative answer, however, the University of Oxford has created the <a href="https://www.bsg.ox.ac.uk/research/research-projects/coronavirus-government-response-tracker">Oxford Stringency Index</a>. In order to explore this questions and create our models, we will work with a second dataset build from the WorldBank open libraries and John Hopkins COVID19 monitor. We mark with “##” the opening of a sub-section. Indeed, the logic for headings is quite simple: “#” for level 1, “##” for level 2, “###” for level 3…</p>
<div id="modelling" class="section level2">
<h2><span class="header-section-number">2.1</span> Modelling</h2>
<p>First, we will load the data. There, we will notice that the structure has changed as now the number of cases has been fixed to a single day. For the new dataset, we normalised the date using as a reference the date 20 days after where the number of cases reached 100. That will helps us to compare the state of the epidemic across countries. So, now we can take a look at our base model, which is relating the number of cases to the size of the population of each country:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;https://raw.githubusercontent.com/aweimann/floto-lab-learning-bioinformatics/master/datasets/COVID19_countries_data.csv&quot;</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">d[, pop <span class="op">:</span><span class="er">=</span><span class="st"> </span>fempop_<span class="dv">2018</span> <span class="op">+</span><span class="st"> </span>male_pop_<span class="dv">2018</span>]</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">m0 &lt;-<span class="st"> </span><span class="kw">lm</span>(confirm <span class="op">~</span><span class="st"> </span>pop, <span class="dt">data =</span> d)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="co"># Configure the plot output to 4 panels</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="kw">plot</span>(m0)</a></code></pre></div>
<p><img src="Rmarkdown_tutorial_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">summary</span>(m0)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = confirm ~ pop, data = d)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -20341.1  -2046.5  -1207.0    660.5  20380.9 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 2.482e+03  7.557e+02   3.284  0.00178 ** 
## pop         1.396e-05  2.842e-06   4.911 8.48e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5394 on 55 degrees of freedom
##   (11 observations deleted due to missingness)
## Multiple R-squared:  0.3049, Adjusted R-squared:  0.2922 
## F-statistic: 24.12 on 1 and 55 DF,  p-value: 8.483e-06</code></pre>
<p>We can see that the number of cases is clearly dependent on the population. Checking the Standardized residual plot, we can see that in fact, most of the countries lie on the expected line, except for a few extreme outliers where our model underestimated the number of cases. In a way, that was something to be expected, as it only means that the more people living in a place the more potential cases we see. Let’s normalize our data to account for this basic observation. To do that, we have two main options: - We could divide the number of cases by the total population. - We could include the population as an effect along with the other factors in the model.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">d[, cases_perM <span class="op">:</span><span class="er">=</span><span class="st"> </span>confirm<span class="op">/</span>(pop<span class="op">/</span><span class="fl">10E6</span>)]</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">lm</span>(confirm <span class="op">~</span><span class="st"> </span>cases_perM, <span class="dt">data =</span> d) <span class="op">%&gt;%</span><span class="st"> </span>summary</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = confirm ~ cases_perM, data = d)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -3627  -2760  -2012   -179  38570 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 3740.57132  949.80545   3.938 0.000233 ***
## cases_perM    -0.01606    0.13420  -0.120 0.905169    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6469 on 55 degrees of freedom
##   (11 observations deleted due to missingness)
## Multiple R-squared:  0.0002604,  Adjusted R-squared:  -0.01792 
## F-statistic: 0.01432 on 1 and 55 DF,  p-value: 0.9052</code></pre>
<p>After our transformation we won’t see an effect of the population on the number of cases anymore. Then, we can explore our transformed variable to explore the other two models that focus on more interesting variables.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">d[, touris_perM <span class="op">:</span><span class="er">=</span><span class="st"> </span>tourist_arrival_<span class="dv">2018</span><span class="op">/</span>pop]</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">m0 &lt;-<span class="st"> </span><span class="kw">lm</span>(cases_perM <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> d) <span class="co"># This notations means that the cases only depends on the global average number of cases</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">m1 &lt;-<span class="st"> </span><span class="kw">lm</span>(cases_perM <span class="op">~</span><span class="st"> </span>Oxford_stringency_level, <span class="dt">data =</span> d)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">m2 &lt;-<span class="st"> </span><span class="kw">lm</span>(cases_perM <span class="op">~</span><span class="st"> </span>tourist_arrival_<span class="dv">2018</span>, <span class="dt">data =</span> d)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">m3 &lt;-<span class="st"> </span><span class="kw">lm</span>(cases_perM <span class="op">~</span><span class="st"> </span>tourist_departure_<span class="dv">2018</span>, <span class="dt">data =</span> d)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">m4 &lt;-<span class="st"> </span><span class="kw">lm</span>(cases_perM <span class="op">~</span><span class="st"> </span>tourist_departure_<span class="dv">2018</span><span class="op">*</span>tourist_arrival_<span class="dv">2018</span>, <span class="dt">data =</span> d)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">m5 &lt;-<span class="st"> </span><span class="kw">lm</span>(cases_perM <span class="op">~</span><span class="st"> </span>touris_perM, <span class="dt">data =</span> d)</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="kw">AIC</span>(m0, m1, m2, m3, m4, m5, </a>
<a class="sourceLine" id="cb11-11" data-line-number="11">    <span class="dt">k =</span> <span class="kw">log</span>(<span class="kw">nrow</span>(d))) <span class="co"># Increase size of the penaly</span></a></code></pre></div>
<pre><code>## Warning in AIC.default(m0, m1, m2, m3, m4, m5, k = log(nrow(d))): models are not
## all fitted to the same number of observations</code></pre>
<pre><code>##    df       AIC
## m0  2 1169.0216
## m1  3 1170.4417
## m2  3 1132.4179
## m3  3  956.1363
## m4  5  961.7240
## m5  3 1125.0671</code></pre>
<p>With this quick look, we can see that the number of cases is completel uncorrelated with the stringency of the country response, becasue this model has very similar AIC compared to the base model. This could perfectly be a result of the relevance of the epidemic in certain countries have motivated unaffected countries to take measures in advance, before the epidemy takes root. However, we could say that including the tourism in the model improves the explanatory power of our model. More precisely, it is the number of tourist departure that give us the best model within this set. Next, we should do proper quality checks to verify that our model assumptions are not broken:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="co"># Configure the plot output to 4 panels</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw">plot</span>(m3)</a></code></pre></div>
<p><img src="Rmarkdown_tutorial_files/figure-html/unnamed-chunk-7-1.png" width="672" /> This check illustrate that our model is still short in power because it still have problems with outliers (rows 13, 36 and 43) and more importantly, we are predicting <em>negative</em> number of cases for two countries. We could continue improving the model, yet we consider it is the time for you to take on and give it a try. Therefore, we would like to propose you to create your own RMarkdown. You can create your model freely, but if you look for some inspiration, we want to suggest 3 potential topics to investigate:</p>
<ol style="list-style-type: decimal">
<li>How would you explain the mortality of the virus in different countries? Do you think the number of doctors or hospital beds matter or it is just a matter of GDP per capita? Maybe the mortality is associated to the fraction of smokers or diabetes?</li>
<li>Once you finish your model, what do you think it means to add a regional intercept to your model? Do any of your parameters gets affected?</li>
<li>For the most advanced students and entusiast, we propose you a little challenge. Could you find a code to:</li>
<li>Calculate the relative increase per day of cases as: <span class="math inline">\(\mu =\frac{R_{t} -R_{t-1}}{R_{t-1}}\)</span></li>
<li>Find the day in wich the curfew was enforced in the COVID19_cases_and_policy dataset. The colum curfew in the dataset indicates with a number 1 when a measure related to this topic has been taken and 0 for all the other days.</li>
<li>Plot the average <span class="math inline">\(\mu\)</span> per country after <span class="math inline">\(n\)</span>-days and explore the impact of this measure.</li>
</ol>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
